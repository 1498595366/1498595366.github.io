<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>文件服务环境搭建与使用 | 程序员小宇`blog，一个分享干货，关注程序员身心健康的播客</title><meta name="keywords" content="程序员小宇`blog，一个分享干货，关注程序员身心健康的播客"><meta name="author" content="程序员小宇"><meta name="copyright" content="程序员小宇"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="文件服务环境搭建与使用技术对比市场上文件服务器很多，最为流行的当属阿里巴巴推出的OSS对象存储服务。其次当属华为推出的OBS对象存储服务。两者各有优缺点。 阿里OSS对象存储服务优点： 能够完美的适配SpringCloudAlibaba系列组件以及中间件。 稳定可靠且性能强大，适合用于互联网产品高并发场景。 缺点： 价格相对昂贵 华为OBS对象存储服务优点： 稳定可靠，可以完美适配华为云系列云服务">
<meta property="og:type" content="article">
<meta property="og:title" content="文件服务环境搭建与使用">
<meta property="og:url" content="https://sheng_yu_lu.gitee.io/posts/38190.html">
<meta property="og:site_name" content="程序员小宇&#96;blog，一个分享干货，关注程序员身心健康的播客">
<meta property="og:description" content="文件服务环境搭建与使用技术对比市场上文件服务器很多，最为流行的当属阿里巴巴推出的OSS对象存储服务。其次当属华为推出的OBS对象存储服务。两者各有优缺点。 阿里OSS对象存储服务优点： 能够完美的适配SpringCloudAlibaba系列组件以及中间件。 稳定可靠且性能强大，适合用于互联网产品高并发场景。 缺点： 价格相对昂贵 华为OBS对象存储服务优点： 稳定可靠，可以完美适配华为云系列云服务">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s1.ax1x.com/2023/04/02/ppfXMfU.jpg">
<meta property="article:published_time" content="2022-11-15T15:34:23.000Z">
<meta property="article:modified_time" content="2023-04-02T15:58:36.361Z">
<meta property="article:author" content="程序员小宇">
<meta property="article:tag" content="程序员小宇&#96;blog，一个分享干货，关注程序员身心健康的播客">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1.ax1x.com/2023/04/02/ppfXMfU.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://sheng_yu_lu.gitee.io/posts/38190"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '文件服务环境搭建与使用',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-04-02 23:58:36'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s1.ax1x.com/2023/04/02/ppfXMfU.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">程序员小宇`blog，一个分享干货，关注程序员身心健康的播客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">文件服务环境搭建与使用</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-11-15T15:34:23.000Z" title="发表于 2022-11-15 23:34:23">2022-11-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-04-02T15:58:36.361Z" title="更新于 2023-04-02 23:58:36">2023-04-02</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="文件服务环境搭建与使用"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="文件服务环境搭建与使用"><a href="#文件服务环境搭建与使用" class="headerlink" title="文件服务环境搭建与使用"></a>文件服务环境搭建与使用</h1><h3 id="技术对比"><a href="#技术对比" class="headerlink" title="技术对比"></a>技术对比</h3><p>市场上文件服务器很多，最为流行的当属阿里巴巴推出的<code>OSS</code>对象存储服务。其次当属华为推出的<code>OBS</code>对象存储服务。两者各有优缺点。</p>
<h5 id="阿里OSS对象存储服务"><a href="#阿里OSS对象存储服务" class="headerlink" title="阿里OSS对象存储服务"></a>阿里OSS对象存储服务</h5><p>优点：</p>
<p>能够完美的适配SpringCloudAlibaba系列组件以及中间件。</p>
<p>稳定可靠且性能强大，适合用于互联网产品高并发场景。</p>
<p>缺点：</p>
<p>价格相对昂贵</p>
<h5 id="华为OBS对象存储服务"><a href="#华为OBS对象存储服务" class="headerlink" title="华为OBS对象存储服务"></a>华为OBS对象存储服务</h5><p>优点：</p>
<p>稳定可靠，可以完美适配华为云系列云服务产品。</p>
<p>价格相对于低廉。</p>
<p>缺点：</p>
<p>不适合用于互联网产品高并发场景。</p>
<h3 id="minio对象存储服务"><a href="#minio对象存储服务" class="headerlink" title="minio对象存储服务"></a>minio对象存储服务</h3><p>然而在<code>TOB</code>领域的项目中请求的并发量通常不会太大，以上介绍的两种存储服务都不太适合，既存在性能过剩资金浪费的问题。<code>minio</code>则是一款分布式开源且<code>完全免费</code>的对象存储服务，非常适合用于<code>TOB</code>领域内网部署且并发量低的项目。</p>
<h3 id="minio环境搭建"><a href="#minio环境搭建" class="headerlink" title="minio环境搭建"></a>minio环境搭建</h3><p>为了避免不同电脑系统以及型号带来的差异，本次采用<code>docker</code>虚拟容器搭建<code>minio</code>，首先拉取docker镜像。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull minio/minio</span><br></pre></td></tr></table></figure>

<p>在镜像拉取的同时，找个目录创建文件夹<code>minio</code>用于存放配置以及数据，注意：<code>不能有中文路径</code>。</p>
<p>在<code>minio</code>文件夹下创建连个子文件夹 <code>data</code> 用于存放数据 <code>config</code>用于存放配置，如图下所示。</p>
<p><img src="../%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8.assets/b.png" alt="b"></p>
<p>在docker镜像拉取完成后运行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>

<p><img src="../%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8.assets/a.pic.jpg" alt="a.pic"></p>
<p>查看<code>minio</code>镜像是否拉取成功，若不成功则必须重复执行上述拉取镜像步骤。</p>
<p>编写docker命令启动minio容器，注意：<code>账号、密码、data目录以及config目录必须设置成自己的</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 9000:9000 -p 9091:9091 </span><br><span class="line">	--name=minio </span><br><span class="line">	--restart=always </span><br><span class="line">	-e &quot;MINIO_ACCESS_KEY=账号&quot; </span><br><span class="line">	-e &quot;MINIO_SECRET_KEY=密码&quot; </span><br><span class="line">	-v minio的data目录:/data </span><br><span class="line">	-v minio的config目录:/root/.minio  </span><br><span class="line">	minio/minio server </span><br><span class="line">	/data --console-address &quot;:9091&quot; --address &quot;:9000&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行完上述命令后执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps </span><br></pre></td></tr></table></figure>

<p>检查 minio容器是否启动成功。</p>
<p><img src="../%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8.assets/c.pic.jpg" alt="4841668490996_.pic"></p>
<p>浏览器输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:9091</span><br></pre></td></tr></table></figure>

<p>则可打开minio界面，登录账号和密码则是在启动docker容器时设置的账号密码</p>
<p><img src="../%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8.assets/d.png" alt="iShot2022-11-15 13.45.59"></p>
<h3 id="minio-存储服务使用"><a href="#minio-存储服务使用" class="headerlink" title="minio 存储服务使用"></a>minio 存储服务使用</h3><p>登录minio后先创建用户</p>
<p><img src="../%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8.assets/e.png" alt="Snipaste_2022-11-15_14-34-14"></p>
<p><img src="../%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8.assets/f.png" alt="image-20221115144702260"></p>
<p>创建分组并选择用户。</p>
<p><img src="../%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8.assets/g.png" alt="Snipaste_2022-11-15_14-58-19"></p>
<p><img src="../%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8.assets/h.png" alt="h"></p>
<p><img src="../%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8.assets/i.png" alt="i"></p>
<p>下载按键点击后会下载一个JSON，<code>必须先保留，开发阶段需要用到</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;url&quot;</span><span class="punctuation">:</span><span class="string">&quot;http://192.168.124.132:9000&quot;</span><span class="punctuation">,</span><span class="attr">&quot;accessKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;13R78M8EW7ZEE1N27024&quot;</span><span class="punctuation">,</span><span class="attr">&quot;secretKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;3WRFZZw6lmPI5XjlT3sp2TW3N80rF3n5sEDUEVdo&quot;</span><span class="punctuation">,</span><span class="attr">&quot;api&quot;</span><span class="punctuation">:</span><span class="string">&quot;s3v4&quot;</span><span class="punctuation">,</span><span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;auto&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>最后进行文件桶（文件存储单元）创建，桶名称可以自定义。注意：<code>不要用中文命名</code></p>
<p><img src="../%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8.assets/j.png" alt="j"></p>
<p>点击browse可以浏览桶中的文件信息，可以在界面上操作文件上传下载以及删除。</p>
<p><img src="../%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8.assets/k.png" alt="k"></p>
<h3 id="Java代码操作-minio"><a href="#Java代码操作-minio" class="headerlink" title="Java代码操作 minio"></a>Java代码操作 minio</h3><p>站在产品的角度，仅仅只通过minio服务器的可视化界面操作是无法满足用户需求的。必须通过程序实现优化操作。</p>
<p><code>完整demo地址</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://gitee.com/sheng_yu_lu/minio-demo.git</span><br></pre></td></tr></table></figure>

<p>yml 文件配置：该文件上传接收对象采用Spring社区提供的 <code>MultipartFile</code>来接收文件。但是默认情况下该类支持的上传下载只支持<code>1MB</code>，所以必须设置文件上传大小为无限大。<code>minio</code>的相关配置 <code>access_key</code>和<code>secret_key</code>则是来源于上文提到的通过minio服务下载的 <code>JSON</code>文件。由于文件桶<code>bucket</code> 在实际项目开发过程中开发环境会与生产环境存在差异，所以也将其配置到yml文件中。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 应用服务 WEB 访问端口</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8087</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用名称</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">minio-demo</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 数据库配置</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="comment"># 采用P6sy监控数据库    </span></span><br><span class="line">    <span class="comment"># url: jdbc:p6spy:mysql://localhost:3306/just_do_it</span></span><br><span class="line">    <span class="comment"># driver-class-name: com.p6spy.engine.spy.P6SpyDriver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/just_do_it</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">12345678</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 设置文件上传大小为无限大 (默认上传大小 1MB)</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">multipart:</span></span><br><span class="line">      <span class="attr">max-file-size:</span> <span class="number">-1</span></span><br><span class="line">      <span class="attr">max-request-size:</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mybatis 相关配置</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:/mapper/*.xml</span> <span class="comment">#配置文件存放位置</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.example.miniodemo.pojo.domain</span> <span class="comment">#实体类存放位置</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mybatis-plus配置控制台打印SQL语句</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">ROOT:</span> <span class="string">info</span></span><br><span class="line">    <span class="attr">com.example.miniodemo:</span> <span class="string">debug</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># minio 相关配置</span></span><br><span class="line"><span class="attr">minio:</span></span><br><span class="line">  <span class="comment"># 服务地址 (必须用API地址)</span></span><br><span class="line">  <span class="attr">url:</span> <span class="string">http://127.0.0.1:9000</span></span><br><span class="line">  <span class="comment"># 服务存取码</span></span><br><span class="line">  <span class="attr">access_key:</span> <span class="string">13R78M8EW7ZEE1N27024</span></span><br><span class="line">  <span class="comment"># 服务私钥</span></span><br><span class="line">  <span class="attr">secret_key:</span> <span class="string">3WRFZZw6lmPI5XjlT3sp2TW3N80rF3n5sEDUEVdo</span></span><br><span class="line">  <span class="comment"># 文件桶</span></span><br><span class="line">  <span class="attr">bucket:</span> <span class="string">public</span></span><br><span class="line">  <span class="comment"># 文件默认下载路径 (当前端传递的文件下载路径为空时，采用该下载路径)</span></span><br><span class="line">  <span class="attr">filePath:</span> <span class="string">/Users/apple/Downloads/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>注意：由于前文配置minio时存在两个端口，<code>其中只有一个是专门用于程序API操作的端口</code>，打开docker可视化界面可知。所以在yml文件中配置端口，<code>必须选在minio服务的9000端口</code></p>
<p><img src="../%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8.assets/l.png" alt="iShot2022-11-10 22.13.51"></p>
<h3 id="Java操作上传下载API封装"><a href="#Java操作上传下载API封装" class="headerlink" title="Java操作上传下载API封装"></a>Java操作上传下载API封装</h3><p><code>minio </code>官网提供了Java操作的示例。 地址：<code>https://min.io/docs/minio/linux/developers/java/minio-java.html?ref=docs-redirect</code>。但该方案过于陈旧繁琐，网上能够找到的方案大多过于老套且不实用。所以需要对其用主流的Spring系列技术进行封装。</p>
<p>由于上文已提供完整demo案例，所以只指出部分Maven坐标引入时所需要注意的点，当前minio Java api 版本已经更新到8系列，然而okhttp 小于 4.8.1 则会导致 minio客户端对象创建失败，<code>所以需要引入大于4.8.1版本okhttp依赖并在minio依赖中排除okhttp坐标解决maven依赖冲突才能正常使用官方推荐的minio 8.4.5 版Maven依赖</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- okhttp 小于 4.8.1 则会导致 minio客户端对象创建失败 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.squareup.okhttp3<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>okhttp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.minio<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>minio<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 排除maven冲突 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>okhttp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.squareup.okhttp3<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><code>minio客户端封装</code>采用spring框架<code>@Configuration</code> 注解声明该类为配置类，用<code>@Bean</code>注解将配置方法实例化的对象放入Spring容器中，当springboot项目启动类运行时则会直接<code>以单例模式</code>实例化，所有注册调用该实例的方法拿到的都会是<code>同一个minioClient对象</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.miniodemo.common.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.minio.MinioClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * minio 配置类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Lv</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/11/10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MinioConfig</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * minio 服务地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;minio.url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String minioUrl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * minio 服务存取码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;minio.access_key&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String accessKey;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * minio 服务私钥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;minio.secret_key&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String secretKey;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化 minio 连接对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MinioClient <span class="title function_">initMinioClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> MinioClient.builder()</span><br><span class="line">                .endpoint(minioUrl)</span><br><span class="line">                .credentials(accessKey, secretKey)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>文件上传下载封装</code>根据官方文档的方式，结合Spring框架对其进行封装。</p>
<p>针对文件上传操作为了方便<code>前后端对接调试</code>，在异常处理上封装了一层全局通用异常处理<code>BusinessException.exception(ResultEnum.UPLOAD_ERROR);</code>既后端异常在控制台打印的同时可以在前端页面上显示，<code>方便开发人员在第一时间定位代码问题</code>，站在产品的角度思考问题，<code>必须配合前端页面显示</code>上传文件操作成功后需要获取到文件的<code>Url</code>地址。前端开发人员是需要通过拿到文件的url地址才能让文件在界面上显示变得可行。为了方便调试<code>快速定位问题</code>以及保证程序<code>健壮性</code>，获取url地址后通过<code>断言</code>的方式保证程序健壮<code>AssertUtils.notEmpty(url, ResultEnum.URL_GET_ERROR);</code>语义：断言该字符串不为空，否则抛出业务异常（获取url失败）阻断程序。</p>
<p>针对文件下载，采用官方提供的方案整合Spring框架封装，用文件名称和文件桶（文件在minio服务中存储的位置）定位需要下载的文件，通过前端传递的文件名称以及下载路径进行下载。为了方便前后端开发调试同样使用了通用异常的处理方式。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.miniodemo.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.common.exception.BusinessException;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.common.result.ResultEnum;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.common.service.FileApi;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.common.util.AssertUtils;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.common.util.PubUtils;</span><br><span class="line"><span class="keyword">import</span> io.minio.DownloadObjectArgs;</span><br><span class="line"><span class="keyword">import</span> io.minio.GetPresignedObjectUrlArgs;</span><br><span class="line"><span class="keyword">import</span> io.minio.MinioClient;</span><br><span class="line"><span class="keyword">import</span> io.minio.PutObjectArgs;</span><br><span class="line"><span class="keyword">import</span> io.minio.http.Method;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文件上传 业务逻辑层 具体实现</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Lv</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/11/10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileApiImpl</span> <span class="keyword">implements</span> <span class="title class_">FileApi</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MinioClient minioClient;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * minio 文件桶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;minio.bucket&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String bucket;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上传单个文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> multipartFile 文件对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">uploadFile</span><span class="params">(MultipartFile multipartFile)</span> &#123;</span><br><span class="line">        <span class="comment">// 参数校验</span></span><br><span class="line">        <span class="keyword">if</span> (PubUtils.isNull(multipartFile) || PubUtils.isEmpty(multipartFile.getOriginalFilename())) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 构造文件上传对象</span></span><br><span class="line">            <span class="type">PutObjectArgs</span> <span class="variable">putObjectArgs</span> <span class="operator">=</span> PutObjectArgs.builder()</span><br><span class="line">                    .bucket(bucket)</span><br><span class="line">                    .object(multipartFile.getOriginalFilename())</span><br><span class="line">                    .stream(multipartFile.getInputStream(), multipartFile.getSize(), -<span class="number">1</span>)</span><br><span class="line">                    .contentType(multipartFile.getContentType())</span><br><span class="line">                    .build();</span><br><span class="line">            <span class="comment">// 上传文件</span></span><br><span class="line">            minioClient.putObject(putObjectArgs);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            BusinessException.exception(ResultEnum.UPLOAD_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回文件路径</span></span><br><span class="line">        <span class="keyword">return</span> getUrl(multipartFile.getOriginalFilename());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取文件url路径</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName 文件名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getUrl</span><span class="params">(String fileName)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            url = minioClient.getPresignedObjectUrl(GetPresignedObjectUrlArgs.builder()</span><br><span class="line">                    .method(Method.GET)</span><br><span class="line">                    .bucket(bucket)</span><br><span class="line">                    .object(fileName)</span><br><span class="line">                    .build());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            BusinessException.exception(ResultEnum.PARAM_INVALID);</span><br><span class="line">        &#125;</span><br><span class="line">        AssertUtils.notEmpty(url, ResultEnum.URL_GET_ERROR);</span><br><span class="line">        <span class="keyword">return</span> url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件默认下载路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;minio.filePath&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String filePath;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件下载</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName         文件名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileDownloadPath 文件下载路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">download</span><span class="params">(String fileName, String fileDownloadPath)</span> &#123;</span><br><span class="line">        <span class="comment">// 当前端传递的下载路径为空则采用默认下载路径</span></span><br><span class="line">        <span class="keyword">if</span> (PubUtils.isEmpty(fileDownloadPath)) &#123;</span><br><span class="line">            fileDownloadPath = filePath;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">DownloadObjectArgs</span> <span class="variable">downloadObjectArgs</span> <span class="operator">=</span> DownloadObjectArgs.builder()</span><br><span class="line">                    .bucket(bucket)</span><br><span class="line">                    .object(fileName)</span><br><span class="line">                    .filename(fileDownloadPath + fileName)</span><br><span class="line">                    .build();</span><br><span class="line">            minioClient.downloadObject(downloadObjectArgs);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            BusinessException.exception(ResultEnum.PARAM_INVALID);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="业务层封装"><a href="#业务层封装" class="headerlink" title="业务层封装"></a>业务层封装</h3><p>上述api封装处理方案仅仅只是针对于文件的操作，其实依然存在无法适应业务功能开发可行性的问题。例如：<code>当文件上传成功后url地址获取失败则会造成minio服务空间资源的浪费</code>。又比如<code>pdf、word、m3u8这类文件在部分app或者浏览器上普通用户无法直接在页面上下载</code>，必须通过点击对应的下载按钮才能下载，然而仅仅只这样封装前端很难做到准确的获取文件名称来调用后端的接口下载。</p>
<p>所以为了规避此类问题必须再进行一层<code>业务上的封装</code>，通过创建一张系统文件表来存储文件相关信息，因为没有整合权限框架所以只设置了除了id外 <code>url  、file_name</code>两个文件相关的字段。在涉及到需要存储文件的模块，仅仅只设置<code>file_id</code>字段，通过存储系统文件表id的方式与文件关联。具体操作如下。 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.miniodemo.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.common.result.ResultEnum;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.common.service.FileApi;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.common.util.AssertUtils;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.common.util.PubUtils;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.pojo.domain.SystemFile;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.mapper.SystemFileMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.common.service.SystemFileService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 系统文件 业务逻辑层 具体实现</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Lv</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/11/11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemFileServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;SystemFileMapper, SystemFile&gt; <span class="keyword">implements</span> <span class="title class_">SystemFileService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SystemFileMapper systemFileMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FileApi fileApi;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上传单个文件并写入数据库</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> multipartFile 上传文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 文件id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">upload</span><span class="params">(MultipartFile multipartFile)</span> &#123;</span><br><span class="line">        <span class="comment">// 当文件为空 不做持久化 返回空</span></span><br><span class="line">        <span class="keyword">if</span> (PubUtils.isNull(multipartFile) || PubUtils.isEmpty(multipartFile.getName())) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 上传文件</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileUrl</span> <span class="operator">=</span> fileApi.uploadFile(multipartFile);</span><br><span class="line">        <span class="comment">// 持久化数据</span></span><br><span class="line">        <span class="type">SystemFile</span> <span class="variable">systemFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SystemFile</span>();</span><br><span class="line">        systemFile.setFileName(multipartFile.getOriginalFilename());</span><br><span class="line">        systemFile.setFileUrl(fileUrl);</span><br><span class="line">        log.info(multipartFile.getOriginalFilename());</span><br><span class="line">        systemFileMapper.insert(systemFile);</span><br><span class="line">        <span class="keyword">return</span> systemFile.getId();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过系统文件id获取文件信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 系统文件id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> SystemFile <span class="title function_">get</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="type">SystemFile</span> <span class="variable">systemFile</span> <span class="operator">=</span> systemFileMapper.selectById(id);</span><br><span class="line">        AssertUtils.notNull(systemFile, ResultEnum.DATA_NOT_EXIST);</span><br><span class="line">        <span class="keyword">return</span> systemFile;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当对应的业务表操作添加和修改，需要涉及文件操作时仅仅只需要调用对应的interface即可。在springCloudAlibaba项目中可将其提升为feign或者dubbo接口方便调用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.miniodemo.common.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.pojo.domain.SystemFile;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 系统文件 业务逻辑层</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Lv</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/11/11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SystemFileService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;SystemFile&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上传单个文件并写入数据库</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> multipartFile 上传文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 文件id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">upload</span><span class="params">(MultipartFile multipartFile)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过系统文件id获取文件信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 系统文件id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    SystemFile <span class="title function_">get</span><span class="params">(Integer id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>涉及文件操作的业务表接口开发</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.miniodemo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.common.commondto.file.FileDownloadDTO;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.common.result.Result;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.pojo.dto.ArticleAddOrEditDTO;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.pojo.dto.ArticleListDTO;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.service.ArticleService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.annotation.Validated;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文章表 前端控制层</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Lv</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/11/11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/article&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ArticleService articleService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加文章</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> articleAddOrEditDTO 文章添加对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;?&gt; add(<span class="meta">@Validated</span> ArticleAddOrEditDTO articleAddOrEditDTO) &#123;</span><br><span class="line">        <span class="keyword">return</span> articleService.add(articleAddOrEditDTO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询文章列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> articleListDTO 文章查询对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;?&gt; list(<span class="meta">@RequestBody</span> ArticleListDTO articleListDTO) &#123;</span><br><span class="line">        <span class="keyword">return</span> articleService.list(articleListDTO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改文章信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id                  文章id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> articleAddOrEditDTO 文章修改对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;?&gt; edit(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id, <span class="meta">@Validated</span> ArticleAddOrEditDTO articleAddOrEditDTO) &#123;</span><br><span class="line">        <span class="keyword">return</span> articleService.edit(id, articleAddOrEditDTO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取文章详情</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 文章id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;?&gt; get(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id) &#123;</span><br><span class="line">        <span class="keyword">return</span> articleService.get(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下载文章</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileDownloadDTO 文件下载数据传输对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/download&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;?&gt; download(<span class="meta">@Validated</span> <span class="meta">@RequestBody</span> FileDownloadDTO fileDownloadDTO) &#123;</span><br><span class="line">        <span class="keyword">return</span> articleService.download(fileDownloadDTO);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>上传单个文件，数据传递对象统一采用spring提供的<code>MultipartFile</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.miniodemo.pojo.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文章添加或修改对象</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Lv</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/11/11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleAddOrEditDTO</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章标题</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> String articleTitle;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> String articleContent;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章作者名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> String articleAuthor;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上传文件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> MultipartFile multipartFile;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>为了方便文件下载处理方便，统一封装文件下载数据传输类。只需要前端获取对应的id并传输下载路径集合调用后端接口进行文件下载。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.miniodemo.common.commondto.file;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通用文件下载数据传输对象</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Lv</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/11/11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileDownloadDTO</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 与文件相关的业务模块数据表对应数据的id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> String businessId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件下载路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String fileDownloadPath;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>涉及文件上传下载模块操作具体业务代码如下,<code>文件上传获取URL并插入数据库后对应的业务表会插入或者更新file_id字段</code> 通过<code>事务机制</code>控制代码出现异常后回滚。<code>注意</code>：由于抛出过异常所以使用@Transactional()注解必须加入 <code>rollbackFor = Exception.class</code>属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.miniodemo.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.common.commondto.file.FileDownloadDTO;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.common.result.Result;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.common.result.ResultEnum;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.common.service.FileApi;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.common.service.SystemFileService;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.common.util.AssertUtils;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.mapper.ArticleMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.pojo.domain.Article;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.pojo.domain.SystemFile;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.pojo.dto.ArticleAddOrEditDTO;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.pojo.dto.ArticleListDTO;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.pojo.vo.ArticleDetailResultVO;</span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.service.ArticleService;</span><br><span class="line"><span class="keyword">import</span> org.modelmapper.ModelMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文章 业务逻辑层 具体实现</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Lv</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/11/11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;ArticleMapper, Article&gt; <span class="keyword">implements</span> <span class="title class_">ArticleService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ArticleMapper articleMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ModelMapper modelMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SystemFileService systemFileService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加文章</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> articleAddOrEditDTO 文章添加对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;?&gt; add(ArticleAddOrEditDTO articleAddOrEditDTO) &#123;</span><br><span class="line">        <span class="comment">// 处理文件并获取文件id并做校验</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">fileId</span> <span class="operator">=</span> systemFileService.upload(articleAddOrEditDTO.getMultipartFile());</span><br><span class="line">        AssertUtils.notNull(fileId, ResultEnum.NOT_EXIST_FILE);</span><br><span class="line">        <span class="comment">// 持久化数据</span></span><br><span class="line">        <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> modelMapper.map(articleAddOrEditDTO, Article.class);</span><br><span class="line">        article.setPublishTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        article.setFileId(fileId);</span><br><span class="line">        articleMapper.insert(article);</span><br><span class="line">        <span class="keyword">return</span> Result.success(article.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取文章详情</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 文章id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;?&gt; get(Integer id) &#123;</span><br><span class="line">        <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> articleMapper.selectById(id);</span><br><span class="line">        AssertUtils.notNull(article, ResultEnum.DATA_NOT_EXIST);</span><br><span class="line">        <span class="comment">// 获取文件信息</span></span><br><span class="line">        <span class="type">SystemFile</span> <span class="variable">systemFile</span> <span class="operator">=</span> systemFileService.get(article.getFileId());</span><br><span class="line">        AssertUtils.notNull(systemFile, ResultEnum.DATA_ERROR);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 封装返回数据</span></span><br><span class="line">        <span class="type">ArticleDetailResultVO</span> <span class="variable">articleDetailVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArticleDetailResultVO</span>();</span><br><span class="line">        articleDetailVO.setId(article.getId());</span><br><span class="line">        articleDetailVO.setArticleTitle(article.getArticleTitle());</span><br><span class="line">        articleDetailVO.setArticleContent(article.getArticleContent());</span><br><span class="line">        articleDetailVO.setArticleAuthor(article.getArticleAuthor());</span><br><span class="line">        articleDetailVO.setPublishTime(article.getPublishTime());</span><br><span class="line">        articleDetailVO.setFileId(article.getFileId());</span><br><span class="line">        articleDetailVO.setFileName(systemFile.getFileName());</span><br><span class="line">        articleDetailVO.setFileUrl(systemFile.getFileUrl());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.success(articleDetailVO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询文章列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> articleListDTO 文章查询对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;?&gt; list(ArticleListDTO articleListDTO) &#123;</span><br><span class="line">        IPage&lt;Article&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(articleListDTO.getPageNo(), articleListDTO.getPageSize());</span><br><span class="line">        IPage&lt;Article&gt; articlePage = articleMapper.selectByTitleAndAuthorAndPublishTime(page, articleListDTO.getArticleTitle(), articleListDTO</span><br><span class="line">                .getArticleAuthor(), articleListDTO.getMinPublishTime(), articleListDTO.getMaxPublishTime());</span><br><span class="line">        <span class="keyword">return</span> Result.success(articlePage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> FileApi fileApi;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下载文章</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileDownloadDTO 文件下载数据传输对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;?&gt; download(FileDownloadDTO fileDownloadDTO) &#123;</span><br><span class="line">        <span class="comment">// 获取文件相关信息</span></span><br><span class="line">        <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> articleMapper.selectById(fileDownloadDTO.getBusinessId());</span><br><span class="line">        AssertUtils.notNull(article, ResultEnum.DATA_NOT_EXIST);</span><br><span class="line">        <span class="type">SystemFile</span> <span class="variable">systemFile</span> <span class="operator">=</span> systemFileService.get(article.getFileId());</span><br><span class="line">        AssertUtils.notNull(systemFile, ResultEnum.DATA_ERROR);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 下载操作</span></span><br><span class="line">        fileApi.download(systemFile.getFileName(), fileDownloadDTO.getFileDownloadPath());</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改文章信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id                  文章id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> articleAddOrEditDTO 文章修改对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;?&gt; edit(Integer id, ArticleAddOrEditDTO articleAddOrEditDTO) &#123;</span><br><span class="line">        <span class="comment">// 文件处理</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">fileId</span> <span class="operator">=</span> systemFileService.upload(articleAddOrEditDTO.getMultipartFile());</span><br><span class="line">        <span class="comment">// 模型转换</span></span><br><span class="line">        <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> modelMapper.map(articleAddOrEditDTO, Article.class);</span><br><span class="line">        article.setId(id);</span><br><span class="line">        article.setFileId(fileId);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> articleMapper.updateById(article);</span><br><span class="line">        <span class="keyword">return</span> count &gt; <span class="number">0</span> ? Result.success(count) : Result.failed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要开发对应的文件预览接口前端可以通过直接获取 file_id 调用对应的系统文件接口即可。但也会存在某些功能需要点开对应模块的详情信息查看文件的需求。针对这类功能开发可以采用<code>VO</code>的方案实现，既 View  Object 视图对象。为方便这类需求快速开发，封装FileResultVO（通用文件视图对象）在编写对应模块的视图对象代码后只需要继承该类即可</p>
<p>FileResultVO 通用文件视图对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.miniodemo.common.commonvo.file;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通用文件视图对象</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Lv</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/11/11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileResultVO</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer fileId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件url路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String fileUrl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ArticleDetailResultVO 文章详情视图对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.miniodemo.pojo.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.miniodemo.common.commonvo.file.FileResultVO;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文章详情视图对象</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Lv</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/11/11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleDetailResultVO</span> <span class="keyword">extends</span> <span class="title class_">FileResultVO</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章标题</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String articleTitle;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String articleContent;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章作者名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String articleAuthor;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发布时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd&quot;, timezone = &quot;GMT+8&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date publishTime;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>对应的详情接口具体实现逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取文章详情</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id 文章id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;?&gt; get(Integer id) &#123;</span><br><span class="line">    <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> articleMapper.selectById(id);</span><br><span class="line">    AssertUtils.notNull(article, ResultEnum.DATA_NOT_EXIST);</span><br><span class="line">    <span class="comment">// 获取文件信息</span></span><br><span class="line">    <span class="type">SystemFile</span> <span class="variable">systemFile</span> <span class="operator">=</span> systemFileService.get(article.getFileId());</span><br><span class="line">    AssertUtils.notNull(systemFile, ResultEnum.DATA_ERROR);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 封装返回数据</span></span><br><span class="line">    <span class="type">ArticleDetailResultVO</span> <span class="variable">articleDetailVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArticleDetailResultVO</span>();</span><br><span class="line">    articleDetailVO.setId(article.getId());</span><br><span class="line">    articleDetailVO.setArticleTitle(article.getArticleTitle());</span><br><span class="line">    articleDetailVO.setArticleContent(article.getArticleContent());</span><br><span class="line">    articleDetailVO.setArticleAuthor(article.getArticleAuthor());</span><br><span class="line">    articleDetailVO.setPublishTime(article.getPublishTime());</span><br><span class="line">    articleDetailVO.setFileId(article.getFileId());</span><br><span class="line">    articleDetailVO.setFileName(systemFile.getFileName());</span><br><span class="line">    articleDetailVO.setFileUrl(systemFile.getFileUrl());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Result.success(articleDetailVO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="接口调试"><a href="#接口调试" class="headerlink" title="接口调试"></a>接口调试</h3><p>接口调试依然采用最主流的postman进行调试。</p>
<p>添加文章信息并上传文件，由于涉及到文件的上传必须采用UDP协议上传，postman对应的操作为form-data。点击如图所示的操作选择<code>file</code>并选择上传文件。</p>
<p><img src="../%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8.assets/m.png" alt="iShot2022-11-11 20.06.39"></p>
<p><img src="../%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8.assets/n.png" alt="m"></p>
<p>获取详情测试</p>
<p><img src="../%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8.assets/o.png" alt="Snipaste_2022-11-15_23-09-58"></p>
<p>点击详情中的<code>url</code>则可以在浏览器页面上查看文件信息。</p>
<p><img src="../%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8.assets/image-20221115231549005.png" alt="image-20221115231549005"></p>
<p>下载文件测试</p>
<p><img src="../%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8.assets/send.png" alt="send"></p>
<p><img src="../%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8.assets/Snipaste.png" alt="Snipaste"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://sheng_yu_lu.gitee.io">程序员小宇</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://sheng_yu_lu.gitee.io/posts/38190.html">https://sheng_yu_lu.gitee.io/posts/38190.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://sheng_yu_lu.gitee.io" target="_blank">程序员小宇`blog，一个分享干货，关注程序员身心健康的播客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://s1.ax1x.com/2023/04/02/ppfXMfU.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/38199.html"><img class="prev-cover" src="https://s1.ax1x.com/2023/04/02/ppfXlpF.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">安卓手机改造成服务器</div></div></a></div><div class="next-post pull-right"><a href="/posts/3.html"><img class="next-cover" src="https://s1.ax1x.com/2023/04/02/ppfXZmn.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">控制台输出完整SQL日志方案</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">程序员小宇</div><div class="author-info__description">一个分享干货，关注程序员身心健康的播客</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">文件服务环境搭建与使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E5%AF%B9%E6%AF%94"><span class="toc-number">1.0.1.</span> <span class="toc-text">技术对比</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%98%BF%E9%87%8COSS%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.0.1.0.1.</span> <span class="toc-text">阿里OSS对象存储服务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8D%8E%E4%B8%BAOBS%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.0.1.0.2.</span> <span class="toc-text">华为OBS对象存储服务</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#minio%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.0.2.</span> <span class="toc-text">minio对象存储服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#minio%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.0.3.</span> <span class="toc-text">minio环境搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#minio-%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1%E4%BD%BF%E7%94%A8"><span class="toc-number">1.0.4.</span> <span class="toc-text">minio 存储服务使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Java%E4%BB%A3%E7%A0%81%E6%93%8D%E4%BD%9C-minio"><span class="toc-number">1.0.5.</span> <span class="toc-text">Java代码操作 minio</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Java%E6%93%8D%E4%BD%9C%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BDAPI%E5%B0%81%E8%A3%85"><span class="toc-number">1.0.6.</span> <span class="toc-text">Java操作上传下载API封装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E5%B1%82%E5%B0%81%E8%A3%85"><span class="toc-number">1.0.7.</span> <span class="toc-text">业务层封装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E8%B0%83%E8%AF%95"><span class="toc-number">1.0.8.</span> <span class="toc-text">接口调试</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/38191.html" title="基于SpringAOP封装自定义注解实现MQ幂等"><img src="https://s1.ax1x.com/2023/04/03/ppfX36J.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于SpringAOP封装自定义注解实现MQ幂等"/></a><div class="content"><a class="title" href="/posts/38191.html" title="基于SpringAOP封装自定义注解实现MQ幂等">基于SpringAOP封装自定义注解实现MQ幂等</a><time datetime="2023-04-02T13:08:23.000Z" title="发表于 2023-04-02 21:08:23">2023-04-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/38199.html" title="安卓手机改造成服务器"><img src="https://s1.ax1x.com/2023/04/02/ppfXlpF.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="安卓手机改造成服务器"/></a><div class="content"><a class="title" href="/posts/38199.html" title="安卓手机改造成服务器">安卓手机改造成服务器</a><time datetime="2022-12-05T15:34:23.000Z" title="发表于 2022-12-05 23:34:23">2022-12-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/38190.html" title="文件服务环境搭建与使用"><img src="https://s1.ax1x.com/2023/04/02/ppfXMfU.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="文件服务环境搭建与使用"/></a><div class="content"><a class="title" href="/posts/38190.html" title="文件服务环境搭建与使用">文件服务环境搭建与使用</a><time datetime="2022-11-15T15:34:23.000Z" title="发表于 2022-11-15 23:34:23">2022-11-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/3.html" title="控制台输出完整SQL日志方案"><img src="https://s1.ax1x.com/2023/04/02/ppfXZmn.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="控制台输出完整SQL日志方案"/></a><div class="content"><a class="title" href="/posts/3.html" title="控制台输出完整SQL日志方案">控制台输出完整SQL日志方案</a><time datetime="2022-10-10T15:34:23.000Z" title="发表于 2022-10-10 23:34:23">2022-10-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/23447.html" title="中台实践，通用后端封装"><img src="https://s1.ax1x.com/2023/04/02/ppfXewq.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="中台实践，通用后端封装"/></a><div class="content"><a class="title" href="/posts/23447.html" title="中台实践，通用后端封装">中台实践，通用后端封装</a><time datetime="2022-09-16T15:34:23.000Z" title="发表于 2022-09-16 23:34:23">2022-09-16</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By 程序员小宇</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>